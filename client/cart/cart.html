<!-- cart display region -->
<template name="cart">
    <div class="page-header">
        <h1>
            <small>My Estimate</small>
            {{#if currentUser}}
                <a style="margin: 5px 0px 0px 30px" class="btn btn-success btn-mini newCart" href="#">Save Estimate</a>
            {{/if}}
        </h1>
    </div>

    <div class="container">
    <table class="span4 table table-striped table-bordered table-hover">
        <thead>
        <th>Qty</th>
        <th>Product</th>
        <th>Price</th>
        <th></th>
        </thead>
        <tbody>
        {{#each cartitems}}
        <tr>
            <td>{{qty}}</td>
            <td>{{productname}}</td>
            <td class="price">{{currency price}}</td>
            <td><span class="label-important label removeci">X</span></td>
        </tr>
        {{else}}
        <tr>
            <td colspan="3">No Products in Cart</td>
        </tr>
        {{/each}}
        <tr>
            <td class="totalcol" colspan="2">SubTotal:</td>
            <td class="totalcolval" id="subtotal" colspan="2">{{currency cartitems.subtotal}}</td>
        </tr>
        <tr>
            <td class="totalcol" colspan="2">Tax ({{percentage taxrate}}):</td>
            <td class="totalcolval" id="tax" colspan="2">{{currency cartitems.tax}}</td>
        </tr>
        <tr>
            <td class="totalcol" colspan="2">Total:</td>
            <td class="totalcolval" id="carttotal" colspan="2">{{currency cartitems.total}}</td>
          <input type="hidden" id="carttotalval" value="{{cartitems.total}}">
        </tr>
        </tbody>
    </table>
    </div>

    {{#if currentUser}}
          <div class="container noCartItems">
            <h4>Items Not Saved</h4>
            <table class="span4 table table-striped table-bordered table-hover">
              <thead>
              <th>Qty</th>
              <th>Product</th>
              <th>Price</th>
              </thead>
              <tbody>
              {{#each cartitems}}
                  {{#unless cart_id}}
                    <tr>
                        <td>{{qty}}</td>
                        <td>{{productname}}</td>
                        <td class="price">{{currency price}}</td>
                    </tr>
                  {{/unless}}
              {{/each}}
              </tbody>
            </table>
          </div>

        {{#if allOwnerCarts}}
            <div class="container carts">
                <h4>Your Saved Estimates</h4>
                    {{#each allOwnerCarts}}
                        <p class="cartlink cart" data-id="{{_id}}"><a href="#" class="editCart" >{{cartName}}</a>  {{currency totalCost}}</p>
                    {{/each}}
            </div>
        {{/if}}
    {{else}}
        <div class="container nocarts">
            <h4>Register and login to save your estimates.</h4>
        </div>
    {{/if}}
</template>

<!-- popup form for saving the cart -->
<template class="cart" name="cartModalNew">
  <div class="modal fade" role="dialog">
    <div class="modal-dialog" >
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title">Create a New Estimate</h4>
        </div>
        <div class="modal-body">
            {{#autoForm id="afCreateCart" type="method" meteormethod="newCart" collection="Cart"}}
              <fieldset>
                  {{> afQuickField name='cartName' label=false placeholder="Name your estimate"}}
                  {{> afQuickField name='totalCost' label=false }}
                  {{> afQuickField name='private' label=false placeholder="Private?"}}
              </fieldset>
              <div class="form-group">
                <button type="submit" class="btn btn-primary" id="save">Save</button>
                <button type="reset" class="btn btn-default">Reset Form</button>
              </div>
            {{/autoForm}}
        </div>
      </div>
    </div>
  </div>
</template>

<!-- popup form for editing the cart -->
<template class="cart" name="cartModalEdit">
  <div class="modal fade" role="dialog">
    <div class="modal-dialog" >
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title">Update Your Estimate</h4>
        </div>
        <div class="modal-body">
            {{#autoForm id="afSaveCart" doc=selectedCartDoc type="method-update" singleMethodArgument=false meteormethod="editCart" collection="Cart"}}
                <div class="container" data_id="{{_id}}"  >
                  <fieldset>
                      {{> afQuickField name='cartName' label=false placeholder="Name your estimate"}}
                      {{> afQuickField name='totalCost' label=false placeholder="Total"}}
                      {{> afQuickField name='private' label=false placeholder="Private"}}
                  </fieldset>
                </div>
                <div class="form-group">
                <button type="submit" class="btn btn-primary" id="save">Save</button>
                <button type="reset" class="btn btn-default">Reset Form</button>
                </div>
            {{/autoForm}}
        </div>
      </div>
    </div>
  </div>
</template>